<!DOCTYPE html>
<html>
<head>
    <title>Distributed Chatroom (WebSocket)</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 800px;
            margin: auto;
        }
        h2 {
            margin-bottom: 5px;
        }
        #roomLabel {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        #chatbox {
            width: 100%;
            height: 300px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
            background-color: #ffffff;
            margin-bottom: 10px;
        }
        #msg {
            width: 75%;
            padding: 10px;
            font-size: 14px;
        }
        #sendBtn {
            padding: 10px 16px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h2>Distributed Chatroom</h2>
    <div id="roomLabel">Room: <span id="roomName">none</span></div>
    <div id="chatbox"></div>
    <br>
    <input type="text" id="msg" placeholder="Type a message..." />
    <button id="sendBtn">Send</button>

    <script>
        const socket = io();
        const chatbox = document.getElementById('chatbox');
        const msgInput = document.getElementById('msg');
        const sendBtn = document.getElementById('sendBtn');
        const roomName = document.getElementById('roomName');

        function addMessage(role, text) {
            const time = new Date().toLocaleTimeString();
            chatbox.innerHTML += `<div><b>[${time}] ${role}:</b> ${text}</div>`;
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        sendBtn.onclick = () => {
            const message = msgInput.value.trim();
            if (!message) return;
            socket.emit('send_message', { message });
            msgInput.value = '';

            // Track current room if joining
            if (message.startsWith('/join')) {
                const parts = message.split(' ');
                if (parts.length === 2) {
                    roomName.textContent = parts[1];
                }
            }

            addMessage("You", message);
        };

        socket.on('server_message', data => {
            addMessage("Server", data.message);
        });
    </script>
</body>
</html>
